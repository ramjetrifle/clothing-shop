<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories - Clothing Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <span class="navbar-brand mb-0 h1">Clothing Shop</span>
        <div>
            <span class="text-white me-3">Welcome, <span id="username"></span></span>
            <a href="/cart" class="btn btn-outline-light btn-sm me-2">Cart</a>
            <button class="btn btn-outline-light btn-sm" onclick="logout()">Logout</button>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2 class="mb-4">Choose a Category</h2>

    <div id="categoriesContainer" class="row g-4">
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const token = localStorage.getItem('token');
    if (!token) {
        window.location.href = '/login';
    }

    document.getElementById('username').textContent = localStorage.getItem('username') || 'User';

    async function loadCategories() {
        try {
            const response = await fetch('/api/categories');
            const categories = await response.json();

            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';

            categories.forEach(category => {
                const categoryCard = `
                        <div class="col-md-4">
                            <div class="card shadow-sm h-100" style="cursor: pointer;" onclick="viewCategory(${category.id})">
                                <div class="card-body text-center">
                                    <h3 class="card-title">${category.name}</h3>
                                    <p class="card-text text-muted">${category.description}</p>
                                    <button class="btn btn-primary">View Products</button>
                                </div>
                            </div>
                        </div>
                    `;
                container.innerHTML += categoryCard;
            });
        } catch (error) {
            console.error('Error loading categories:', error);
            alert('Failed to load categories');
        }
    }

    function viewCategory(categoryId) {
        window.location.href = `/products?categoryId=${categoryId}`;
    }

    function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('username');
        window.location.href = '/login';
    }

    loadCategories();
</script>
</body>
</html>